<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datawrapper CSV</title>
    <!-- Sisipkan Pustaka Papa Parse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <h1>Datawrapper CSV Example</h1>
    <div id="csv_table"></div>

    <script>
        // Ambil data dari folder Google Drive
        const folderName = 'Rekomendasi Saham Asia'; // Ganti dengan nama folder Google Drive Anda

        // Fungsi untuk mengambil file CSV dari Google Drive menggunakan Google Drive API
        async function fetchCSVFromGoogleDrive(folderName) {
            try {
                // Mengambil daftar file dari folder Google Drive
                const response = await fetch(`https://www.googleapis.com/drive/v3/files?q='${folderName}' in parents&key=AIzaSyAkyhyKLorThqufzYOwKA5aZTdI5qqTao8`);
                const data = await response.json();

                // Mengambil ID file CSV dari folder
                const csvFileId = data.files.find(file => file.mimeType === 'text/csv').id;

                // Mengambil isi file CSV menggunakan ID file
                const csvResponse = await fetch(`https://www.googleapis.com/drive/v3/files/${csvFileId}?alt=media&key=YOUR_API_KEY`);
                const csvData = await csvResponse.text();

                return csvData;
            } catch (error) {
                console.error('Error:', error);
                throw error;
            }
        }

        // Menampilkan data CSV dalam tabel HTML
        async function displayCSV() {
            try {
                // Mengambil data CSV dari Google Drive
                const csvData = await fetchCSVFromGoogleDrive(folderName);

                // Parsing data CSV menggunakan Papa Parse
                const parsedCSV = Papa.parse(csvData, { header: true });
                const table = document.createElement('table');
                const thead = table.createTHead();
                const tbody = table.createTBody();

                // Buat header tabel
                const headers = Object.keys(parsedCSV.data[0]);
                const headerRow = thead.insertRow();
                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });

                // Isi data tabel
                parsedCSV.data.forEach(rowData => {
                    const row = tbody.insertRow();
                    headers.forEach(header => {
                        const cell = row.insertCell();
                        cell.textContent = rowData[header];
                    });
                });

                // Tampilkan tabel di HTML
                document.getElementById('csv_table').appendChild(table);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Panggil fungsi untuk menampilkan data CSV saat halaman dimuat
        displayCSV();
    </script>
</body>
</html>
